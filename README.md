# Развертывание проекта Pharaon-online_beta на Railway

Этот документ содержит подробные инструкции по развертыванию Flask-приложения на платформе Railway и настройке Telegram бота для работы с Mini App.

## Предварительные требования

- Аккаунт на [Railway](https://railway.app/) (бесплатный тариф доступен).
- Созданный Telegram бот через [@BotFather](https://t.me/botfather). Вам понадобится BOT_TOKEN.

## Шаги развертывания

1. **Создайте новый проект на Railway:**
   - Перейдите на [Railway Dashboard](https://railway.app/dashboard).
   - Нажмите "New Project" и выберите "Deploy from GitHub repo" (или подключите ваш репозиторий).

2. **Подключите Git-репозиторий:**
   - Если проект еще не в Git, создайте репозиторий на GitHub и загрузите код.
   - В Railway подключите репозиторий к проекту.

3. **Добавьте переменные окружения (Environment Variables):**
   - В настройках проекта Railway перейдите в раздел "Variables".
   - Добавьте переменную `BOT_TOKEN` со значением токена вашего Telegram бота.
   - Railway автоматически добавит переменную `DATABASE_URL` для подключения к базе данных PostgreSQL (если включена).

4. **Настройте базу данных (опционально):**
   - Если приложение использует базу данных, добавьте плагин PostgreSQL в Railway (бесплатно до определенных лимитов).

Railway автоматически обнаружит `requirements.txt` и установит зависимости, а также запустит приложение на основе `app.py`.

## Настройка Telegram бота

1. **Откройте BotFather:**
   - Перейдите к [@BotFather](https://t.me/botfather) в Telegram.

2. **Установите Web App URL:**
   - Выберите вашего бота и используйте команду `/setmenubutton`.
   - Установите тип кнопки как "Web App" и укажите URL вашего Railway-приложения (например, `https://your-app-name.railway.app`).

Это позволит пользователям открывать Mini App прямо из чата с ботом.

## Запуск

Railway автоматически развернет ваше Flask-приложение при пуше в репозиторий или при ручном запуске. Приложение будет доступно по URL, предоставленному Railway.

## Тестирование

1. **Проверьте здоровье приложения:**
   - Перейдите по URL Railway и добавьте `/health` (например, `https://your-app-name.railway.app/health`).
   - Убедитесь, что возвращается статус 200 OK.

2. **Протестируйте Mini App в Telegram:**
   - Откройте чат с вашим ботом.
   - Нажмите кнопку меню (если настроена) или используйте команду для открытия Web App.
   - Проверьте функциональность Mini App.

## Дополнительные советы по production

- **Логирование:** Используйте Railway logs для мониторинга. Добавьте структурированное логирование в код (например, с помощью `logging` модуля Python).
- **Безопасность:** Храните чувствительные данные только в переменных окружения. Не коммитите ключи в Git.
- **Масштабирование:** Railway автоматически масштабирует приложение, но мониторьте использование ресурсов.
- **Бэкапы:** Если используете базу данных, настройте регулярные бэкапы через Railway.
- **Обновления:** При изменениях в коде пушьте в Git, и Railway переразвернет приложение.
- **Мониторинг:** Интегрируйте инструменты вроде Sentry для отслеживания ошибок.
- **Производительность:** Оптимизируйте запросы к базе данных и используйте кэширование, если необходимо.

Если возникнут проблемы, проверьте логи Railway или обратитесь в их поддержку.